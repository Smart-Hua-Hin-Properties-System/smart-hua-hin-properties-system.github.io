<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART ADMIN | V106.0 Profile Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a5276; --navy: #154360; --bg: #9fb8dc; --white: #ffffff; --red: #e74c3c; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; overflow-x: hidden; }

        /* üîí ‡∏™‡πà‡∏ß‡∏ô LOGIN (Manual + Eye Toggle) */
        .login-card { background: white; padding: 40px; border-radius: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 90%; max-width: 420px; text-align: center; }
        .pin-wrapper { position: relative; margin: 25px 0; }
        .pin-input { width: 100%; padding: 15px; font-size: 28px; text-align: center; border: 2px solid #eee; border-radius: 20px; letter-spacing: 6px; outline: none; transition: 0.3s; box-sizing: border-box; }
        .pin-input:focus { border-color: var(--primary); }
        .eye-btn { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #ccc; font-size: 1.2rem; }

        /* üìä ‡∏™‡πà‡∏ß‡∏ô DASHBOARD & PROFILE */
        #mainDashboard { display: none; background: #f4f7f6; position: fixed; inset: 0; z-index: 1000; overflow-y: auto; }
        .admin-header { background: var(--navy); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1100; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        .profile-banner { background: var(--primary); color: white; padding: 40px 20px; text-align: center; border-radius: 0 0 50px 50px; }
        .profile-pic { width: 110px; height: 110px; border-radius: 50%; border: 4px solid white; object-fit: cover; background: #eee; margin-bottom: 15px; }

        .content-area { max-width: 700px; margin: -40px auto 50px; padding: 0 15px; }
        .info-card { background: white; padding: 30px; border-radius: 35px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        .form-row { margin-bottom: 18px; }
        label { font-size: 0.8rem; color: #999; display: block; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; }
        input { width: 100%; padding: 12px; border-radius: 12px; border: 1.5px solid #eee; box-sizing: border-box; font-family: 'Kanit'; font-size: 1rem; }
        input[readonly] { background: #f9f9f9; border-color: transparent; color: #666; }

        .btn { width: 100%; padding: 16px; border-radius: 20px; border: none; font-weight: 600; cursor: pointer; transition: 0.3s; font-size: 1rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-logout { background: var(--red); color: white; width: auto; padding: 8px 18px; font-size: 0.85rem; }
        
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px; }
        .menu-item { background: white; padding: 20px; border-radius: 25px; text-align: center; font-size: 0.85rem; font-weight: 600; color: var(--primary); box-shadow: 0 5px 15px rgba(0,0,0,0.03); cursor: pointer; }
        .menu-item i { font-size: 1.8rem; display: block; margin-bottom: 8px; }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="login-card" id="loginPortal">
        <div style="font-size: 55px; margin-bottom: 10px;">üõ°Ô∏è</div>
        <h2 style="color: var(--primary); margin: 0;">ADMIN ACCESS</h2>
        <p style="color: #888;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN 6 ‡∏´‡∏•‡∏±‡∏Å</p>
        
        <div class="pin-wrapper">
            <input type="password" id="pinInput" class="pin-input" maxlength="6" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <i class="fas fa-eye eye-btn" id="eyeIcon" onclick="toggleEye()"></i>
        </div>
        
        <button class="btn btn-primary" id="loginBtn" onclick="handleLogin()">
            <i class="fas fa-sign-in-alt"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        </button>
        <p id="errorBox" style="color: var(--red); margin-top: 15px; font-size: 0.85rem; font-weight: 500;"></p>
    </div>

    <div id="mainDashboard">
        <div class="admin-header">
            <span style="font-weight: 900; letter-spacing: 1px;">SMART DASHBOARD</span>
            <button class="btn-logout btn" onclick="location.reload()">LOGOUT</button>
        </div>

        <div class="profile-banner">
            <img id="p_Photo" src="" class="profile-pic">
            <h2 id="p_Name" style="margin: 0;">-</h2>
            <div id="p_Role" style="font-size: 0.8rem; opacity: 0.8; margin-top: 5px;">-</div>
        </div>

        <div class="content-area">
            <div id="roleBasedMenu" class="menu-grid"></div>

            <div class="info-card">
                <h3 style="color: var(--primary); margin-top: 0;"><i class="fas fa-user-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
                <form id="profileForm">
                    <div class="form-row"><label>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (Read Only)</label><input type="text" id="Agent_PIN" readonly></div>
                    <div class="form-row"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" id="Full_Name" required></div>
                    <div class="form-row"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="text" id="Phone"></div>
                    <div class="form-row"><label>LINE ID</label><input type="text" id="Line_ID"></div>
                    <div class="form-row"><label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label><input type="text" id="Email"></div>
                    
                    <h4 style="color: var(--primary); border-top: 1px solid #f0f0f0; padding-top: 20px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</h4>
                    <div class="form-row"><label>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</label><input type="text" id="Bank_Name"></div>
                    <div class="form-row"><label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label><input type="text" id="Bank_Account_Number"></div>
                    <div class="form-row"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label><input type="text" id="Bank_Account_Name"></div>
                    
                    <div class="form-row"><label>URL ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (Direct Link)</label><input type="text" id="Profile_Photo_URL"></div>

                    <button type="submit" class="btn btn-primary" id="saveBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</button>
                </form>
                <div id="statusMsg" style="text-align: center; margin-top: 15px; font-weight: 600;"></div>
            </div>
        </div>
    </div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyS8rGtSnhVS8RdWje7icXZVCw5iBBJoWkEpOYm649OC6FOhnrVi87dD9GsJl_m_FVw/exec";
    let userData = null;

    /** üëÅÔ∏è ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏î‡∏ß‡∏á‡∏ï‡∏≤ [cite: 2026-01-30] */
    function toggleEye() {
        const input = document.getElementById('pinInput');
        const icon = document.getElementById('eyeIcon');
        if (input.type === "password") {
            input.type = "text"; icon.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
            input.type = "password"; icon.classList.replace('fa-eye-slash', 'fa-eye');
        }
    }

    /** üîí ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Login (Manual) [cite: 2026-01-30] */
    async function handleLogin() {
        const pin = document.getElementById('pinInput').value;
        const err = document.getElementById('errorBox');
        const btn = document.getElementById('loginBtn');

        if (pin.length < 6) { err.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 6 ‡∏´‡∏•‡∏±‡∏Å"; return; }

        btn.disabled = true; btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';

        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: "login", pin: pin }) });
            const data = await res.json();
            if (data.success) {
                userData = data.userData;
                renderDashboard();
            } else {
                err.innerText = data.message; btn.disabled = false; btn.innerHTML = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            }
        } catch (e) { err.innerText = "‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß"; btn.disabled = false; }
    }

    /** üìä ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏´‡∏ô‡πâ‡∏≤ Dashboard ‡πÅ‡∏•‡∏∞‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå [cite: 2026-01-27] */
    function renderDashboard() {
        document.getElementById('loginPortal').classList.add('hidden');
        document.getElementById('mainDashboard').style.display = 'block';
        document.body.style.background = "#f4f7f6";

        // ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
        document.getElementById('p_Name').innerText = userData.Full_Name;
        document.getElementById('p_Role').innerText = userData.Role + " | Access: " + userData.Project_Access;
        document.getElementById('p_Photo').src = userData.Profile_Photo_URL || "https://placehold.co/200x200?text=AGENT";

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏™‡πà‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        for (let key in userData) {
            const el = document.getElementById(key);
            if (el) el.value = userData[key];
        }

        renderMenu(userData.Role);
    }

    function renderMenu(role) {
        const menuBox = document.getElementById('roleBasedMenu');
        let html = "";
        if (role === "SUPER_ADMIN") {
            html += `<div class="menu-item"><i class="fas fa-database"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>`;
            html += `<div class="menu-item"><i class="fas fa-users-cog"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô</div>`;
        } else if (role === "PROJECT_ADMIN") {
            html += `<div class="menu-item"><i class="fas fa-home"></i>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ö‡πâ‡∏≤‡∏ô</div>`;
            html += `<div class="menu-item"><i class="fas fa-user-friends"></i>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏°‡∏∏‡πà‡∏á‡∏´‡∏ß‡∏±‡∏á</div>`;
        } else {
            html += `<div class="menu-item"><i class="fas fa-search"></i>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>`;
            html += `<div class="menu-item"><i class="fas fa-wallet"></i>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡∏ô</div>`;
        }
        menuBox.innerHTML = html;
    }

    /** üíæ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (Update Profile) [cite: 2026-01-27] */
    document.getElementById('profileForm').onsubmit = async (e) => {
        e.preventDefault();
        const msg = document.getElementById('statusMsg');
        const btn = document.getElementById('saveBtn');
        btn.disabled = true; msg.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";

        const payload = { action: "updateProfile" };
        new FormData(e.target).forEach((v, k) => payload[k] = v);
        payload.Agent_PIN = document.getElementById('Agent_PIN').value; // ‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏Å Read-only

        try {
            const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
            const data = await res.json();
            if (data.success) {
                msg.style.color = "green"; msg.innerText = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
                setTimeout(() => msg.innerText = "", 3000);
            }
        } catch (e) { msg.style.color = "red"; msg.innerText = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î"; }
        btn.disabled = false;
    };
</script>
</body>
</html>
