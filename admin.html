<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Login - SMART SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a5276; --bg: #f4f7f6; --white: #ffffff; --green: #27ae60; --text: #2c3e50; --border: #ddd; --loader-bg: #9CBCE3; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; padding: 0; color: var(--text); overflow: hidden; display: flex; flex-direction: column; height: 100vh; }

        /* üé® ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏î‡∏∏‡πä‡∏Å‡∏î‡∏¥‡πä‡∏Å‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ */
        #loader-container { position: fixed; inset: 0; background: var(--loader-bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.5s ease; }
        .emoji-group { display: flex; gap: 15px; margin-bottom: 25px; font-size: 60px; }
        .bounce { animation: bounce 0.6s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-20px); } }
        .loader-text { color: white; font-weight: 900; font-size: 1.6rem; letter-spacing: 1px; text-transform: uppercase; text-align: center; }

        /* üö© Header */
        header { background: #fff; padding: 12px 15px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header-left { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .brand-name { font-weight: 500; font-size: 0.85rem; color: var(--primary); text-transform: uppercase; border-left: 1.5px solid #eee; padding-left: 10px; }

        /* üîê Login Box */
        .login-container { flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .login-card { background: #fff; width: 100%; max-width: 400px; padding: 40px 30px; border-radius: 35px; box-shadow: 0 15px 40px rgba(0,0,0,0.1); text-align: center; }
        .login-icon { width: 80px; height: 80px; background: var(--bg); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 25px; color: var(--primary); font-size: 2rem; }
        
        h2 { color: var(--primary); margin-bottom: 10px; font-weight: 600; }
        p { color: #888; font-size: 0.9rem; margin-bottom: 30px; }

        .input-group { margin-bottom: 20px; text-align: left; }
        .input-label { display: block; font-size: 0.8rem; color: var(--primary); margin-left: 15px; margin-bottom: 5px; font-weight: 500; text-transform: uppercase; }
        .input-field { width: 100%; padding: 15px 20px; border-radius: 50px; border: 1.5px solid var(--border); box-sizing: border-box; font-family: 'Kanit'; outline: none; transition: 0.3s; font-size: 1rem; text-align: center; letter-spacing: 2px; }
        .input-field:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(26,82,118,0.1); }

        .btn-login { width: 100%; padding: 15px; border-radius: 50px; border: none; background: var(--primary); color: white; font-family: 'Kanit'; font-size: 1.1rem; font-weight: 500; cursor: pointer; transition: 0.3s; box-shadow: 0 8px 20px rgba(26,82,118,0.2); }
        .btn-login:active { transform: scale(0.98); }

        #error-msg { color: var(--red); font-size: 0.85rem; margin-top: 15px; display: none; }
    </style>
</head>
<body>

<div id="loader-container">
    <div class="emoji-group">
        <span class="bounce">üêö</span><span class="bounce" style="animation-delay:0.2s">üåä</span><span class="bounce" style="animation-delay:0.4s">üå¥</span>
    </div>
    <div class="loader-text">SMART PROPERTIES SYSTEM</div>
</div>

<header>
    <div class="header-left" onclick="location.href='index.html'">
        <i class="fas fa-chevron-left" style="color:var(--primary);"></i>
        <span style="font-size: 0.85rem; color: var(--primary); font-weight: 500;">BACK TO SITE</span>
        <div class="brand-name">ADMIN ACCESS</div>
    </div>
</header>

<div class="login-container">
    <div class="login-card" id="login-box">
        <div class="login-icon"><i class="fas fa-user-shield"></i></div>
        <h2>Agent Login</h2>
        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</p>
        
        <div class="input-group">
            <span class="input-label">Access Key</span>
            <input type="password" id="accessKey" class="input-field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="20">
        </div>

        <button class="btn-login" onclick="handleLogin()">ENTER SYSTEM</button>
        <div id="error-msg">‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</div>
    </div>

    <div id="success-box" style="display:none; text-align:center;">
        <div class="login-icon" style="background:var(--green); color:white;"><i class="fas fa-check"></i></div>
        <h2 id="welcome-name">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2>
        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå...</p>
    </div>
</div>

<script>
    const api = "https://script.google.com/macros/s/AKfycbwUqp_vaFNgUdyARh5WG-S3iRm_x1C4EX0tL8aw12nhKpvYVn3I7SwWmi5s-doiYGYh/exec";

    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡∏î‡∏∏‡πä‡∏Å‡∏î‡∏¥‡πä‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°
    window.onload = () => {
        setTimeout(() => {
            const loader = document.getElementById('loader-container');
            loader.style.opacity = '0';
            setTimeout(() => loader.style.display = 'none', 500);
        }, 800);
    };

    async function handleLogin() {
        const key = document.getElementById('accessKey').value;
        const errorMsg = document.getElementById('error-msg');
        const loginBtn = document.querySelector('.btn-login');

        if (!key) return;

        loginBtn.disabled = true;
        loginBtn.innerHTML = '<i class="fas fa-sync fa-spin"></i> Checking...';
        errorMsg.style.display = 'none';

        try {
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô universalLogin ‡πÉ‡∏ô Apps Script
            const response = await fetch(`${api}?action=universalLogin&key=${key}`);
            const result = await response.json();

            if (result.success) {
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Login ‡∏•‡∏á‡πÉ‡∏ô LocalStorage
                localStorage.setItem('admin_token', key);
                localStorage.setItem('agent_name', result.name);
                
                showSuccess(result.name);
            } else {
                errorMsg.style.display = 'block';
                loginBtn.disabled = false;
                loginBtn.innerText = 'ENTER SYSTEM';
            }
        } catch (e) {
            alert("Connection Error. Please check your internet.");
            loginBtn.disabled = false;
            loginBtn.innerText = 'ENTER SYSTEM';
        }
    }

    function showSuccess(name) {
        document.getElementById('login-box').style.display = 'none';
        document.getElementById('success-box').style.display = 'block';
        document.getElementById('welcome-name').innerText = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì ${name}`;
        
        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÑ‡∏õ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2
        setTimeout(() => {
            alert("‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏´‡∏ô‡πâ‡∏≤ Dashboard");
            // ‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        }, 1500);
    }
</script>
</body>
</html>
