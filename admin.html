<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART CONTROL | MASTER ADMIN</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --navy: #1a4361; --gold-bg: #fff3cd; --gold-border: #ffeeba;
            --gold-btn: #856404; --blue-btn: #1a5276; --red-btn: #e74c3c;
        }
        body { font-family: 'Kanit', sans-serif; background: #f4f7f6; margin: 0; }
        
        /* Header */
        header { background: var(--navy); padding: 12px 30px; color: white; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .logo-box { display: flex; align-items: center; gap: 10px; font-weight: 600; font-size: 1.1rem; }
        .master-badge { background: #5d7a8c; color: white; padding: 2px 12px; border-radius: 50px; font-size: 0.75rem; font-weight: 400; }
        .logout-btn { background: var(--red-btn); color: white; border: none; padding: 7px 18px; border-radius: 6px; cursor: pointer; font-family: 'Kanit'; font-weight: 500; }

        .container { max-width: 950px; margin: 40px auto; padding: 0 20px; }
        h2 { color: var(--navy); font-weight: 500; font-size: 1.8rem; margin-bottom: 35px; }

        /* ‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡∏ó‡∏≠‡∏á: ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î */
        .exec-card { background: var(--gold-bg); border: 1.5px solid var(--gold-border); border-radius: 15px; padding: 25px; margin-bottom: 25px; }
        .exec-label { color: #856404; font-weight: 600; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.1rem; }
        .btn-gold { background: var(--gold-btn); color: white; width: 100%; padding: 18px; border-radius: 12px; border: none; font-family: 'Kanit'; font-size: 1.1rem; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; box-shadow: 0 4px 10px rgba(133,100,4,0.3); text-decoration: none; }

        /* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡πâ‡∏≤‡∏ô */
        .btn-blue { background: var(--blue-btn); color: white; width: 100%; padding: 20px; border-radius: 12px; border: none; font-family: 'Kanit'; font-size: 1.2rem; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 25px; box-shadow: 0 8px 15px rgba(26,82,118,0.2); }

        /* ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå */
        .search-container { background: white; border-radius: 15px; padding: 15px; margin-bottom: 25px; display: flex; align-items: center; border: 1px solid #ddd; box-shadow: 0 4px 10px rgba(0,0,0,0.02); }
        .search-container i { color: #999; margin-right: 15px; font-size: 1.2rem; }
        .search-container input { border: none; outline: none; width: 100%; font-family: 'Kanit'; font-size: 1.1rem; color: #333; }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≤‡∏ß‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
        .main-white-box { background: white; border-radius: 25px; padding: 40px; border: 1px solid #eee; box-shadow: 0 5px 25px rgba(0,0,0,0.03); min-height: 200px; }
        .sync-icon { font-size: 3rem; color: var(--navy); margin-bottom: 25px; }
        .loading-msg { font-size: 1.15rem; color: #333; font-weight: 500; }

        .hidden { display: none !important; }
        #login-ui { position: fixed; inset: 0; background: white; z-index: 2000; display: flex; align-items: center; justify-content: center; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≤‡∏ß */
        .property-item { text-align: left; padding: 25px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; }
        .property-item:hover { background: #f9fbff; }
        .property-item:last-child { border: none; }
        .item-title { font-weight: 600; color: var(--navy); font-size: 1.2rem; margin-bottom: 5px; }
        .item-sub { font-size: 0.9rem; color: #666; }
        .edit-btn { color: var(--blue-btn); cursor: pointer; transition: 0.2s; font-size: 1.8rem; }
    </style>
</head>
<body>

<div id="login-ui">
    <div style="text-align:center; max-width:350px; width:100%; padding:20px;">
        <i class="fas fa-shield-halved fa-4x" style="color:var(--navy); margin-bottom:20px;"></i>
        <h2 style="margin-bottom:30px;">Admin Login</h2>
        <input type="password" id="pinInput" placeholder="ENTER ACCESS PIN" style="width:100%; padding:18px; border-radius:12px; border:1px solid #ddd; text-align:center; font-size:1.5rem; outline:none; margin-bottom:25px; box-sizing:border-box;">
        <button onclick="handleLogin()" style="width:100%; padding:15px; border-radius:12px; background:var(--navy); color:white; border:none; font-weight:600; cursor:pointer; font-size:1.1rem;">ACCESS DASHBOARD</button>
    </div>
</div>

<div id="dashboard-ui" class="hidden">
    <header>
        <div class="logo-box">Smart Control <span class="master-badge">Master</span></div>
        <div id="user-display" style="font-weight:400; font-size:0.95rem;">MASTER_ADMIN</div>
        <button class="logout-btn" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </header>

    <div class="container">
        <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‡∏ó‡∏∏‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h2>

        <div id="exec-section" class="exec-card hidden">
            <div class="exec-label"><i class="fas fa-crown"></i> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
            <a href="dashboard.html" class="btn-gold">
                <i class="fas fa-chart-line"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (Executive Dashboard)
            </a>
        </div>

        <button class="btn-blue" onclick="alert('‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...')">
            <i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        </button>

        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" id="adminSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå (HP-XXXX) ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£..." onkeyup="filterData()">
        </div>

        <div class="main-white-box">
            <div id="loading-state">
                <div style="text-align:center;">
                    <div class="sync-icon"><i class="fas fa-sync fa-spin"></i></div>
                    <div class="loading-msg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏´‡∏≤‡∏≠‡∏≥‡∏ô‡∏≤‡∏à...</div>
                </div>
            </div>
            <div id="data-list" class="hidden">
                </div>
        </div>
    </div>
</div>

<script>
    // üîó URL Apps Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö
    const webAppUrl = "https://script.google.com/macros/s/AKfycbxUduvVQ2oDjgJT3HJlGDzpbEav1_orj-G2UalilY27QoRtSgNOHPFdw7-NNYPdakA8/exec";
    let allProperties = [];
    let currentUser = null;

    async function handleLogin() {
        const pin = document.getElementById('pinInput').value;
        try {
            const response = await fetch(`${webAppUrl}?action=universalLogin&key=${pin}`);
            const result = await response.json();
            if (result.success) {
                currentUser = result;
                localStorage.setItem('smart_session', JSON.stringify(result));
                renderUI();
            } else { alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); }
        } catch(e) { alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß"); }
    }

    function renderUI() {
        currentUser = currentUser || JSON.parse(localStorage.getItem('smart_session'));
        if (!currentUser) return;

        document.getElementById('login-ui').classList.add('hidden');
        document.getElementById('dashboard-ui').classList.remove('hidden');
        document.getElementById('user-display').innerText = currentUser.name;

        // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡∏ó‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Super Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        if (currentUser.role === 'SUPER_ADMIN') {
            document.getElementById('exec-section').classList.remove('hidden');
        }

        loadProperties();
    }

    async function loadProperties() {
        try {
            const response = await fetch(`${webAppUrl}?role=${currentUser.role}&project=${currentUser.project}`);
            allProperties = await response.json();
            
            const listDiv = document.getElementById('data-list');
            document.getElementById('loading-state').classList.add('hidden');
            listDiv.classList.remove('hidden');

            renderList(allProperties);
        } catch(e) {
            document.getElementById('loading-state').innerHTML = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        }
    }

    function renderList(data) {
        const listDiv = document.getElementById('data-list');
        listDiv.innerHTML = data.map(item => `
            <div class="property-item">
                <div>
                    <div class="item-title">${item.HP_ID} | ${item.ID}</div>
                    <div class="item-sub">${item.District} | ${item.Status} | ‡∏ø${Number(item.Price).toLocaleString()}</div>
                </div>
                <div class="edit-btn" onclick="alert('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå: ${item.HP_ID}')">
                    <i class="fas fa-edit"></i>
                </div>
            </div>
        `).join('');
    }

    function filterData() {
        const val = document.getElementById('adminSearch').value.toLowerCase();
        const filtered = allProperties.filter(p => 
            p.HP_ID.toLowerCase().includes(val) || 
            p.ID.toLowerCase().includes(val) ||
            p.District.toLowerCase().includes(val)
        );
        renderList(filtered);
    }

    function logout() { localStorage.clear(); location.reload(); }
    window.onload = () => { if(localStorage.getItem('smart_session')) renderUI(); };
</script>
</body>
</html>
