<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent HQ V7.5 - Syntax Correct</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a5276; --bg: #f0f4f7; --white: #ffffff; --orange: #e67e22; --green: #27ae60; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; font-weight: 300; color: #333; }
        .header { background: var(--primary); color: white; padding: 40px 20px; text-align: center; border-radius: 0 0 40px 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .profile-img { width: 90px; height: 90px; border-radius: 50%; border: 3px solid white; object-fit: cover; margin-bottom: 10px; }
        .nav-tabs { background: #fff; display: flex; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tab-item { padding: 15px 5px; color: #7f8c8d; text-decoration: none; font-size: 0.78rem; flex: 1; text-align: center; border-bottom: 3px solid transparent; cursor: pointer; transition: 0.3s; }
        .tab-item.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 400; }
        .container { padding: 20px; max-width: 850px; margin: 0 auto; padding-bottom: 60px; }
        .card { background: white; border-radius: 25px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        label { font-size: 0.75rem; color: #7f8c8d; margin-bottom: 6px; display: block; }
        input, select, textarea { width: 100%; padding: 14px; border-radius: 12px; border: 1.5px solid #eee; font-family: 'Kanit'; box-sizing: border-box; font-weight: 300; outline: none; margin-bottom: 15px; background: #fafafa; font-size: 0.95rem; }
        .btn-submit { background: var(--primary); color: white; border: none; padding: 16px; width: 100%; border-radius: 15px; cursor: pointer; font-family: 'Kanit'; font-size: 1rem; font-weight: 400; }
        .status-badge { padding: 4px 12px; border-radius: 50px; font-size: 0.65rem; background: #d4edda; color: #155724; }
    </style>
</head>
<body>

<div class="header">
    <img id="agentPhoto" src="https://via.placeholder.com/90" class="profile-img">
    <h2 id="agentName" style="margin:0; font-weight:400; letter-spacing:1px;">...</h2>
    <div id="agencyBadge" style="font-size:0.8rem; opacity:0.8; margin-top:5px;">...</div>
</div>

<div class="nav-tabs">
    <div class="tab-item active" onclick="showTab('history', this)"><i class="fas fa-history"></i> à¸›à¸£à¸°à¸§à¸±à¸•à¸´</div>
    <div class="tab-item" onclick="showTab('appointment', this)"><i class="fas fa-calendar-check"></i> à¸™à¸±à¸”à¸«à¸¡à¸²à¸¢</div>
    <div class="tab-item" onclick="showTab('checkin', this)"><i class="fas fa-map-marker-alt"></i> à¹€à¸Šà¹‡à¸„à¸­à¸´à¸™</div>
    <div class="tab-item" onclick="showTab('profile', this)"><i class="fas fa-user-cog"></i> à¹‚à¸›à¸£à¹„à¸Ÿà¸¥à¹Œ</div>
</div>

<div class="container">
    <div id="historySection" class="tab-content">
        <h4 style="font-weight:400; color:var(--primary);"><i class="fas fa-clipboard-list"></i> à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸‡à¸²à¸™à¹€à¸Šà¹‡à¸„à¸­à¸´à¸™</h4>
        <div id="visitLogs"></div>
    </div>
    </div>

<script>
    // ðŸŽ¯ à¸ªà¸³à¸„à¸±à¸: à¸§à¸²à¸‡ URL à¹€à¸§à¹‡à¸šà¹à¸­à¸›à¸‚à¸­à¸‡à¸¡à¸²à¸ªà¹€à¸•à¸­à¸£à¹Œà¸—à¸µà¹ˆà¸™à¸µà¹ˆà¸„à¸£à¸±à¸š
    const api = "https://script.google.com/macros/s/AKfycbyvjIDptiWlUVKmTdHUGVkC0rMdQV5McDPTuTCLDkVHyjD7N_aX34WysVJkORq1ECFK/exec";
    const agentPin = localStorage.getItem('agentPin');
    let agentNameGlobal = "", lat = "", lng = "";

    async function init() {
        if(!agentPin) window.location.href = 'login.html';
        const r = await fetch(`${api}?action=getAgentData&agentPin=${agentPin}`);
        const d = await r.json();
        if(!d.success) return;

        const a = d.agent;
        agentNameGlobal = a.name;
        document.getElementById('agentName').innerText = a.name;
        document.getElementById('agentPhoto').src = a.photo || "https://via.placeholder.com/90";
        document.getElementById('agencyBadge').innerText = a.agency;
        
        document.getElementById('visitLogs').innerHTML = d.visits.map(v => `<div class="card"><div style="display:flex; justify-content:space-between; align-items:center;"><div><b>${v.Project || '-'}</b><br><small>${v.Timestamp ? new Date(v.Timestamp).toLocaleDateString('th-TH') : '-'}</small></div><span class="status-badge">${v.Status || 'Waiting'}</span></div></div>`).join('');
    }
    // (à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸ªà¸£à¸´à¸¡à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡...)
    function showTab(t, el) {
        document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
        document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active'));
        document.getElementById(t + 'Section').style.display = 'block';
        el.classList.add('active');
    }
    init();
</script>
</body>
</html>
