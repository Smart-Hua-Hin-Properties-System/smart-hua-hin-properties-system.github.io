<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXECUTIVE SALES DASHBOARD | SMART SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --header-bg: #1a4361; --body-bg: #f8fafb;
            --blue: #1a5276; --orange: #d35400; --green: #27ae60; --purple: #8e44ad; --gold: #f1c40f;
        }
        body { font-family: 'Kanit', sans-serif; background: var(--body-bg); margin: 0; padding-bottom: 50px; color: #333; overflow-x: hidden; }
        
        /* üîµ Header Section */
        .dash-header { background: var(--header-bg); color: white; padding: 45px 20px; text-align: center; }
        .dash-header h1 { margin: 0; font-size: 1.8rem; letter-spacing: 1px; font-weight: 600; text-transform: uppercase; }
        .dash-header p { margin: 10px 0 0; opacity: 0.8; font-weight: 300; font-size: 0.95rem; }

        .container { max-width: 1200px; margin: -25px auto 0; padding: 0 15px; }

        /* üîô Back Button Pill */
        .back-nav { 
            display: inline-flex; align-items: center; gap: 10px; 
            background: white; padding: 12px 25px; border-radius: 50px; 
            text-decoration: none; color: #1a5276; font-weight: 600; font-size: 0.95rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 25px; transition: 0.3s;
        }
        .back-nav:hover { transform: translateX(-5px); box-shadow: 0 6px 20px rgba(0,0,0,0.12); }

        /* üìç Location Grid (4 Cards) */
        .location-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .loc-card { 
            background: white; padding: 25px 20px; border-radius: 15px; 
            display: flex; align-items: center; gap: 18px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.03); border-left: 6px solid;
        }
        .loc-card i { font-size: 2.2rem; }
        .loc-info .loc-name { font-size: 0.85rem; color: #888; font-weight: 500; margin-bottom: 2px; }
        .loc-info .loc-value { font-size: 1.5rem; font-weight: 600; color: #1a4361; }

        /* üí∞ KPI Grid (3 Cards) */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { 
            background: white; border-radius: 25px; padding: 45px 20px; text-align: center; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.04); transition: 0.3s;
        }
        .kpi-card i { font-size: 2.8rem; margin-bottom: 20px; display: block; }
        .kpi-label { font-size: 0.95rem; color: #777; margin-bottom: 15px; font-weight: 400; }
        .kpi-val { font-size: 2.2rem; font-weight: 600; }

        /* üìë Summary List Section */
        .summary-box { 
            background: white; border-radius: 30px; padding: 35px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.03); margin-bottom: 30px;
        }
        .summary-title { 
            display: flex; align-items: center; gap: 12px; 
            font-size: 1.25rem; font-weight: 600; color: #333; margin-bottom: 25px; border-bottom: 1px solid #f0f0f0; padding-bottom: 15px;
        }

        /* Project Row Styling */
        .project-row { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 20px; border-bottom: 1px solid #f9f9f9; transition: 0.2s;
        }
        .project-row:hover { background: #fcfdfe; }
        .project-row:last-child { border: none; }
        .proj-name { font-weight: 600; color: var(--header-bg); font-size: 1.1rem; }
        .proj-meta { font-size: 0.85rem; color: #888; margin-top: 4px; }
        .proj-stats { text-align: right; }
        .proj-val { font-weight: 600; color: var(--blue); font-size: 1.1rem; }

        .sync-spinner { font-size: 3rem; color: #ddd; margin: 40px 0; text-align: center; display: block; }

        @media (max-width: 768px) {
            .dash-header h1 { font-size: 1.4rem; }
            .kpi-val { font-size: 1.8rem; }
            .loc-card { padding: 20px 15px; }
            .project-row { flex-direction: column; align-items: flex-start; gap: 10px; }
            .proj-stats { text-align: left; border-top: 1px dashed #eee; width: 100%; pt: 10px; margin-top: 5px; padding-top: 10px; }
        }
    </style>
</head>
<body>

<div class="dash-header">
    <h1>EXECUTIVE SALES DASHBOARD</h1>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏ì‡∏≤‡∏à‡∏±‡∏Å‡∏£ Smart-Hua Hin Properties</p>
</div>

<div class="container">
    <a href="admin.html" class="back-nav">
        <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
    </a>

    <div class="location-grid">
        <div class="loc-card" style="border-left-color: var(--blue);">
            <i class="fas fa-city" style="color: var(--blue);"></i>
            <div class="loc-info">
                <div class="loc-name">‡∏´‡∏±‡∏ß‡∏´‡∏¥‡∏ô (Hua Hin)</div>
                <div class="loc-value" id="count-huahin">0 ‡∏´‡∏•‡∏±‡∏á</div>
            </div>
        </div>
        <div class="loc-card" style="border-left-color: var(--orange);">
            <i class="fas fa-umbrella-beach" style="color: var(--orange);"></i>
            <div class="loc-info">
                <div class="loc-name">‡∏ä‡∏∞‡∏≠‡∏≥ (Cha-am)</div>
                <div class="loc-value" id="count-chaam">0 ‡∏´‡∏•‡∏±‡∏á</div>
            </div>
        </div>
        <div class="loc-card" style="border-left-color: var(--green);">
            <i class="fas fa-mountain" style="color: var(--green);"></i>
            <div class="loc-info">
                <div class="loc-name">‡∏õ‡∏£‡∏≤‡∏ì‡∏ö‡∏∏‡∏£‡∏µ (Pranburi)</div>
                <div class="loc-value" id="count-pranburi">0 ‡∏´‡∏•‡∏±‡∏á</div>
            </div>
        </div>
        <div class="loc-card" style="border-left-color: var(--purple);">
            <i class="fas fa-globe" style="color: var(--purple);"></i>
            <div class="loc-info">
                <div class="loc-name">‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</div>
                <div class="loc-value" id="count-total">0 ‡∏´‡∏•‡∏±‡∏á</div>
            </div>
        </div>
    </div>

    <div class="kpi-grid">
        <div class="kpi-card">
            <i class="fas fa-coins" style="color: var(--blue);"></i>
            <div class="kpi-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏≠‡∏≤‡∏ì‡∏≤‡∏à‡∏±‡∏Å‡∏£</div>
            <div class="kpi-val" id="total-assets" style="color: var(--blue);">‡∏ø0</div>
        </div>
        <div class="kpi-card">
            <i class="fas fa-handshake" style="color: var(--green);"></i>
            <div class="kpi-label">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ (SOLD)</div>
            <div class="kpi-val" id="total-sold" style="color: var(--green);">‡∏ø0</div>
        </div>
        <div class="kpi-card">
            <i class="fas fa-piggy-bank" style="color: var(--gold);"></i>
            <div class="kpi-label">‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡∏ô‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏° (1.5%)</div>
            <div class="kpi-val" id="total-commission" style="color: var(--gold);">‡∏ø0</div>
        </div>
    </div>

    <div class="summary-box">
        <div class="summary-title">
            <i class="fas fa-list-ul"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
        </div>
        <div id="loading-summary">
            <i class="fas fa-sync fa-spin sync-spinner"></i>
        </div>
        <div id="project-list-summary">
            </div>
    </div>
</div>

<script>
    const apiURL = "https://script.google.com/macros/s/AKfycbzKZevcdiLQo3wjOvJ0cm1rQVZlS8WkbpyAyQTKZEQ3eC7c31h3MEP7RA9FDlDOsNM4/exec";

    async function loadFullDashboard() {
        try {
            const response = await fetch(apiURL);
            const data = await response.json();
            
            let stats = { hh: 0, ca: 0, pb: 0, total: 0, assetVal: 0, soldVal: 0 };
            let projectMap = {}; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ [cite: 2026-01-27]

            data.forEach(item => {
                const price = Number(item.Price) || 0;
                const pName = item.Project_Name || item["Project Name"] || "‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ";
                
                stats.total++;
                stats.assetVal += price;
                if (item.Status === 'Sold') stats.soldVal += price;

                // 1. ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
                const district = String(item.District || "").toLowerCase();
                if (district.includes("hua hin")) stats.hh++;
                else if (district.includes("cha-am") || district.includes("cha am")) stats.ca++;
                else if (district.includes("pranburi")) stats.pb++;

                // 2. ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
                if (!projectMap[pName]) {
                    projectMap[pName] = { count: 0, value: 0, soldCount: 0, district: item.District || "N/A" };
                }
                projectMap[pName].count++;
                projectMap[pName].value += price;
                if (item.Status === 'Sold') projectMap[pName].soldCount++;
            });

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏ô
            document.getElementById('count-huahin').innerText = stats.hh + ' ‡∏´‡∏•‡∏±‡∏á';
            document.getElementById('count-chaam').innerText = stats.ca + ' ‡∏´‡∏•‡∏±‡∏á';
            document.getElementById('count-pranburi').innerText = stats.pb + ' ‡∏´‡∏•‡∏±‡∏á';
            document.getElementById('count-total').innerText = stats.total + ' ‡∏´‡∏•‡∏±‡∏á';
            document.getElementById('total-assets').innerText = '‡∏ø' + stats.assetVal.toLocaleString();
            document.getElementById('total-sold').innerText = '‡∏ø' + stats.soldVal.toLocaleString();
            document.getElementById('total-commission').innerText = '‡∏ø' + (stats.soldVal * 0.015).toLocaleString();

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏•‡πà‡∏≤‡∏á: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
            const summaryDiv = document.getElementById('project-list-summary');
            document.getElementById('loading-summary').style.display = 'none';
            
            summaryDiv.innerHTML = Object.keys(projectMap).map(name => {
                const p = projectMap[name];
                return `
                    <div class="project-row">
                        <div>
                            <div class="proj-name">${name}</div>
                            <div class="proj-meta">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${p.district} | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${p.count} ‡∏¢‡∏π‡∏ô‡∏¥‡∏ï</div>
                        </div>
                        <div class="proj-stats">
                            <div class="proj-val">‡∏ø${p.value.toLocaleString()}</div>
                            <div class="proj-meta">‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß ${p.soldCount} ‡∏´‡∏•‡∏±‡∏á</div>
                        </div>
                    </div>
                `;
            }).join('');

        } catch (error) {
            document.getElementById('loading-summary').innerHTML = "<p style='color:red;'>‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>";
        }
    }

    window.onload = loadFullDashboard;
</script>
</body>
</html>
