<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SMART PROPERTIES | Public</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root { --primary:#1a5276; --bg:#9CBCE3; --white:#fff; --green:#00d44b; --text:#2c3e50; --border:#eee; }
    html,body{font-family:'Kanit',sans-serif;background:var(--bg);margin:0;overflow-x:hidden;width:100%}
    *{box-sizing:border-box}
    #loader-container{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;transition:.5s}
    .emoji-group{display:flex;gap:15px;margin-bottom:25px;font-size:60px}
    .bounce{animation:bounce .6s infinite alternate}
    @keyframes bounce{from{transform:translateY(0)}to{transform:translateY(-20px)}}

    header{background:#fff;padding:12px 15px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:1000;box-shadow:0 2px 10px rgba(0,0,0,.1)}
    .header-left{display:flex;align-items:center;gap:8px;cursor:pointer;color:var(--primary)}
    .flag-list{display:flex;gap:5px}
    .flag-btn{border:none;background:none;padding:0;cursor:pointer}
    .flag-btn img{width:24px;height:16px;border-radius:2px}

    .sidebar{position:fixed;left:-320px;top:0;width:280px;height:100%;background:#fff;z-index:3500;transition:.4s;padding-top:30px;box-shadow:5px 0 35px rgba(0,0,0,.15);border-radius:0 40px 40px 0}
    .sidebar.active{left:0}
    .sidebar-item{padding:14px 25px;margin:8px 15px;display:flex;align-items:center;gap:18px;text-decoration:none;color:var(--text);border-radius:20px;transition:.3s}
    .sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(26,82,118,.2);z-index:3000;backdrop-filter:blur(4px)}
    .sidebar-overlay.active{display:block}

    .filter-area{padding:15px;width:100%;max-width:1200px;margin:0 auto}
    .filter-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;background:rgba(255,255,255,.9);padding:15px;border-radius:25px}
    @media(min-width:768px){.filter-grid{grid-template-columns:repeat(4,1fr)}}
    .select-box{width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);font-family:'Kanit';color:var(--primary);font-size:.82rem}

    .property-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;padding:0 15px 40px;max-width:1200px;margin:0 auto}
    .card{background:var(--white);border-radius:40px;overflow:hidden;position:relative;box-shadow:0 15px 35px rgba(0,0,0,.1)}
    .badge{position:absolute;top:20px;left:20px;background:var(--green);color:#fff;padding:6px 18px;border-radius:50px;font-weight:500;font-size:.8rem;z-index:10}
    .card-img{width:100%;height:350px;object-fit:cover}
    .btn-detail{display:block;width:90%;margin:0 auto 20px;padding:14px;background:var(--primary);color:#fff;text-align:center;border-radius:50px;text-decoration:none;font-weight:500}
  </style>
</head>
<body>

<div id="loader-container">
  <div class="emoji-group">
    <span class="bounce" style="animation-delay:0s">üêö</span>
    <span class="bounce" style="animation-delay:0.2s">üåä</span>
    <span class="bounce" style="animation-delay:0.4s">üå¥</span>
  </div>
  <div style="color:white;font-weight:900;font-size:1.5rem;">SMART PROPERTIES</div>
</div>

<div class="sidebar-overlay" id="overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
  <div style="padding:0 30px 20px;"><h2 style="color:var(--primary);">SMART SYSTEM</h2></div>
  <a href="index.html" class="sidebar-item"><i class="fas fa-home"></i> <span data-lang="menuHome">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span></a>
  <a href="admin.html" class="sidebar-item"><i class="fas fa-user-shield"></i> <span>Admin Access</span></a>
</div>

<header>
  <div class="header-left" onclick="toggleSidebar()">
    <i class="fas fa-bars fa-lg"></i> <span style="font-size:0.85rem;font-weight:500;margin-left:5px;">‡πÄ‡∏°‡∏ô‡∏π</span>
  </div>
  <div style="font-weight:900;color:var(--primary);font-size:0.9rem;">HUAHIN.PROPERTIES</div>
  <div class="flag-list">
    <button class="flag-btn" onclick="setLanguage('th')"><img src="https://flagcdn.com/w40/th.png"></button>
    <button class="flag-btn" onclick="setLanguage('en')"><img src="https://flagcdn.com/w40/us.png"></button>
  </div>
</header>

<div class="filter-area">
  <div class="filter-grid">
    <select class="select-box" id="distFilter" onchange="updateSubDistricts()">
      <option value="" data-lang="optDist">üìç ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
      <option value="‡∏´‡∏±‡∏ß‡∏´‡∏¥‡∏ô">‡∏´‡∏±‡∏ß‡∏´‡∏¥‡∏ô</option>
      <option value="‡∏ä‡∏∞‡∏≠‡∏≥">‡∏ä‡∏∞‡∏≠‡∏≥</option>
      <option value="‡∏õ‡∏£‡∏≤‡∏ì‡∏ö‡∏∏‡∏£‡∏µ">‡∏õ‡∏£‡∏≤‡∏ì‡∏ö‡∏∏‡∏£‡∏µ</option>
    </select>

    <select class="select-box" id="subDistFilter" onchange="applyFilters()">
      <option value="" data-lang="optSub">üèòÔ∏è ‡∏ï‡∏≥‡∏ö‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
    </select>

    <select class="select-box" id="bedFilter" onchange="applyFilters()">
      <option value="" data-lang="optBed">üõå ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
      <option value="1">1 Bed</option><option value="2">2 Beds</option><option value="3">3 Beds</option>
      <option value="4">4 Beds</option><option value="5">5 Beds</option><option value="6">6 Beds</option>
      <option value="6.5">6+ Beds</option>
    </select>

    <select class="select-box" id="priceSort" onchange="applyFilters()">
      <option value="" data-lang="optPrice">üí∞ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤</option>
      <option value="low" data-lang="priceLow">‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å</option>
      <option value="high" data-lang="priceHigh">‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢</option>
    </select>
  </div>
</div>

<div class="property-grid" id="grid"></div>

<script>
  const api = "https://script.google.com/macros/s/AKfycbzkweiEgczmmU_4FiqRffJ4exvgZl3RwGPIBWXssLgkUpdMArif9-eUEv6yP2Kvtzh1/exec";
  let allData = [];
  let currentLang = localStorage.getItem('smartLang') || 'th';

  const i18n = {
    th: { optDist:"üìç ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", optSub:"üèòÔ∏è ‡∏ï‡∏≥‡∏ö‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", optBed:"üõå ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", optPrice:"üí∞ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤", priceLow:"‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å", priceHigh:"‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢", view:"‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î", menuHome:"‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å" },
    en: { optDist:"üìç All Districts", optSub:"üèòÔ∏è Sub-districts", optBed:"üõå Bedrooms", optPrice:"üí∞ Sort Price", priceLow:"Low to High", priceHigh:"High to Low", view:"View Details", menuHome:"Home" }
  };

  function toggleSidebar(){
    document.getElementById('sidebar').classList.toggle('active');
    document.getElementById('overlay').classList.toggle('active');
  }

  function setLanguage(lang){
    currentLang = lang;
    localStorage.setItem('smartLang', lang);
    const t = i18n[lang] || i18n.en;
    document.querySelectorAll('[data-lang]').forEach(el=>{
      const k = el.getAttribute('data-lang');
      if(t[k]) el.innerText = t[k];
    });
    // ‡∏£‡∏µ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
    applyFilters();
  }

  function imgUrl(url){
    if(!url) return "https://placehold.co/600x800";
    // Apps Script ‡∏à‡∏∞‡∏™‡πà‡∏á H3 ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
    if(url.includes("lh3.googleusercontent.com/d/")) return url;
    // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô drive link
    if(url.includes("id=")) {
      const id = url.split("id=")[1].split("&")[0];
      return "https://lh3.googleusercontent.com/d/" + id;
    }
    return url;
  }

  async function init(){
    try{
      const res = await fetch(`${api}?role=PUBLIC`);
      allData = await res.json();

      setLanguage(currentLang);

      // ‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏ï‡∏≥‡∏ö‡∏•‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï (‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß)
      updateSubDistricts();

      document.getElementById('loader-container').style.opacity='0';
      setTimeout(()=>document.getElementById('loader-container').style.display='none', 500);
    }catch(e){
      document.getElementById('grid').innerHTML = "Error Connecting to Database";
    }
  }

  // ‚úÖ ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‚Äú‡∏ï‡∏≥‡∏ö‡∏•‚Äù ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  function updateSubDistricts(){
    const district = document.getElementById('distFilter').value;
    const subSel = document.getElementById('subDistFilter');

    const t = i18n[currentLang] || i18n.en;
    subSel.innerHTML = `<option value="">${t.optSub}</option>`;

    if(district){
      const subs = [...new Set(
        allData
          .filter(it => String(it.District || "").trim() === district)
          .map(it => String(it.SubDistrict || "").trim())
          .filter(x => x)
      )].sort((a,b)=>a.localeCompare(b,'th'));

      subs.forEach(s=>{
        const opt = document.createElement("option");
        opt.value = s;
        opt.textContent = s;
        subSel.appendChild(opt);
      });
    }

    applyFilters();
  }

  function applyFilters(){
    let data = [...allData];

    const d = document.getElementById('distFilter').value;
    const s = document.getElementById('subDistFilter').value;
    const b = document.getElementById('bedFilter').value;
    const sort = document.getElementById('priceSort').value;

    if(d) data = data.filter(it => String(it.District||"").trim() === d);
    if(s) data = data.filter(it => String(it.SubDistrict||"").trim() === s);

    if(b){
      if(b === "6.5") data = data.filter(it => Number(it.Bedrooms||0) >= 6);
      else data = data.filter(it => Number(it.Bedrooms||0) >= Number(b));
    }

    if(sort === "low") data.sort((a,b)=>Number(a.Price||0)-Number(b.Price||0));
    if(sort === "high") data.sort((a,b)=>Number(b.Price||0)-Number(a.Price||0));

    renderGrid(data);
  }

  function renderGrid(items){
    const grid = document.getElementById('grid');
    grid.innerHTML = "";

    items.forEach(it=>{
      const img = imgUrl(it.Thumbnail);
      const price = Number(it.Price || 0).toLocaleString();
      const viewText = (i18n[currentLang] || i18n.en).view;

      // ‚úÖ ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ó‡∏µ‡πà 2: ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ details ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á HP_ID ‡∏à‡∏£‡∏¥‡∏á ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà undefined
      const id = encodeURIComponent(String(it.HP_ID || "").trim());

      grid.innerHTML += `
        <div class="card">
          <div class="badge">CODE: ${it.ID || ""}</div>
          <img src="${img}" class="card-img" onerror="this.src='https://placehold.co/600x800'">
          <div style="padding:18px 18px 0;">
            <div style="font-size:0.8rem;color:#888;margin-bottom:5px;">${it.Project_Name || "HUAHIN"}</div>
            <div style="font-size:1.8rem;color:var(--primary);font-weight:600;margin-bottom:20px;">‡∏ø${price}</div>
          </div>
          <a href="details.html?id=${id}" class="btn-detail">${viewText}</a>
        </div>
      `;
    });
  }

  window.onload = init;
</script>
</body>
</html>
