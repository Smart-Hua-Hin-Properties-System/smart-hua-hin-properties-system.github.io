<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart-Hua Hin-Properties-System</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a5276; --bg: #f0f2f5; --white: #ffffff; --green: #27ae60; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; padding: 0; overflow-x: hidden; }

        /* üì± Header & Navigation */
        header { 
            background: #fff; padding: 10px 15px; display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .menu-icon { font-size: 1.5rem; color: var(--primary); cursor: pointer; }
        .brand-name { font-weight: 600; font-size: 1.1rem; color: var(--primary); text-transform: uppercase; }
        
        .flag-list { display: flex; gap: 5px; }
        .flag-list img { width: 24px; height: 16px; border-radius: 2px; cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }

        /* üö™ Side Bar */
        .sidebar {
            position: fixed; left: -280px; top: 0; width: 280px; height: 100%; background: var(--white);
            z-index: 2000; transition: 0.3s; box-shadow: 5px 0 15px rgba(0,0,0,0.1); padding-top: 60px;
        }
        .sidebar.active { left: 0; }
        .sidebar-item { padding: 15px 25px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 15px; text-decoration: none; color: var(--text); }
        .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1500; }
        .sidebar-overlay.active { display: block; }

        /* üîç Filter Bar */
        .filter-section { background: var(--white); padding: 15px; margin: 10px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .filter-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .filter-box { position: relative; }
        select { 
            width: 100%; padding: 12px 15px; border-radius: 10px; border: 1px solid #ddd; appearance: none;
            background: #fff; font-family: 'Kanit'; font-size: 0.95rem; color: var(--primary); cursor: pointer;
        }
        .filter-box::after { content: '\f078'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: var(--primary); pointer-events: none; }

        /* üè† Property Grid */
        .property-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px; padding: 10px; }
        .card { background: var(--white); border-radius: 20px; overflow: hidden; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .card-img-box { position: relative; height: 230px; }
        .card-img { width: 100%; height: 100%; object-fit: cover; }
        
        /* üè∑Ô∏è Badge Style */
        .hpid-badge { 
            position: absolute; top: 12px; left: 12px; background: var(--green); color: white;
            padding: 6px 15px; border-radius: 50px; font-weight: 600; font-size: 0.85rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 10;
        }

        .card-body { padding: 15px; }
        .card-title { font-weight: 600; font-size: 1.1rem; margin-bottom: 5px; color: var(--primary); }
        .card-info { font-size: 0.9rem; color: #7f8c8d; display: flex; gap: 10px; margin-bottom: 10px; }
        .card-price { font-size: 1.4rem; font-weight: 600; color: var(--primary); }
        .status-tag { display: inline-block; padding: 3px 10px; border-radius: 5px; font-size: 0.75rem; background: #e8f5e9; color: var(--green); font-weight: 600; }
        
        .btn-detail { 
            display: block; width: 100%; padding: 12px; background: var(--primary); color: white;
            text-align: center; text-decoration: none; border-radius: 10px; font-weight: 600; margin-top: 15px;
        }

        #loading { text-align: center; padding: 100px; font-size: 1.1rem; color: var(--primary); }
    </style>
</head>
<body>

<header>
    <div class="header-left">
        <div class="menu-icon" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
        <div class="brand-name" id="currentProjectName">Smart Property</div>
    </div>
    <div class="flag-list">
        <img src="https://flagcdn.com/w40/th.png" title="Thai">
        <img src="https://flagcdn.com/w40/us.png" title="English">
        <img src="https://flagcdn.com/w40/cn.png" title="Chinese">
        <img src="https://flagcdn.com/w40/ru.png" title="Russian">
        <img src="https://flagcdn.com/w40/de.png" title="German">
        <img src="https://flagcdn.com/w40/fr.png" title="French">
    </div>
</header>

<div class="sidebar-overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
    <a href="#" class="sidebar-item"><i class="fas fa-home"></i> ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
    <a href="#" class="sidebar-item"><i class="fas fa-building"></i> ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
    <a href="#" class="sidebar-item"><i class="fas fa-star"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î</a>
    <a href="#" class="sidebar-item"><i class="fas fa-envelope"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a>
</div>

<div class="filter-section">
    <div class="filter-grid">
        <div class="filter-box">
            <select id="idFilter" onchange="applyFilters()">
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏õ‡∏•‡∏á/‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£...</option>
            </select>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="filter-box">
                <select id="bedroomFilter" onchange="applyFilters()">
                    <option value="">‡∏ó‡∏∏‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô</option>
                    <option value="1">1 ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô</option>
                    <option value="2">2 ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô</option>
                    <option value="3">3 ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô</option>
                    <option value="4">4 ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô</option>
                    <option value="5">5 ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô</option>
                    <option value="6">6+ ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô</option>
                </select>
            </div>
            <div class="filter-box">
                <select id="sortFilter" onchange="applyFilters()">
                    <option value="low">‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏ô‡πâ‡∏≠‡∏¢ ‚Üí ‡∏°‡∏≤‡∏Å</option>
                    <option value="high">‡∏£‡∏≤‡∏Ñ‡∏≤: ‡∏°‡∏≤‡∏Å ‚Üí ‡∏ô‡πâ‡∏≠‡∏¢</option>
                </select>
            </div>
        </div>
    </div>
</div>

<div id="loading"><i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Smart Properties...</div>
<div class="property-grid" id="grid"></div>

<script>
    const webAppUrl = "https://script.google.com/macros/s/AKfycbytY48pBly91AAPJ4I6oy7QtuS451d-U5EKBvIwtobMQrty2Q3zsUw6P9LI3zm7Z4E7/exec";
    let rawData = [];
    const urlParams = new URLSearchParams(window.location.search);
    const initialProject = urlParams.get('project');

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('active');
        document.querySelector('.sidebar-overlay').classList.toggle('active');
    }

    async function loadData() {
        try {
            const res = await fetch(webAppUrl);
            const data = await res.json();
            rawData = data;
            
            // Set Brand Name
            if (initialProject) document.getElementById('currentProjectName').innerText = initialProject;

            // Populate ID Filter
            const idFilter = document.getElementById('idFilter');
            const uniqueIds = [...new Set(data.map(item => item.ID))].sort();
            uniqueIds.forEach(id => {
                const opt = document.createElement('option');
                opt.value = id;
                opt.innerText = "ID: " + id;
                idFilter.appendChild(opt);
            });

            applyFilters();
        } catch (e) { document.getElementById('loading').innerText = "‚ùå ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Admin"; }
    }

    function applyFilters() {
        let filtered = [...rawData];
        const idVal = document.getElementById('idFilter').value;
        const bedVal = document.getElementById('bedroomFilter').value;
        const sortVal = document.getElementById('sortFilter').value;

        // 1. Project Filter (From URL)
        if (initialProject) {
            filtered = filtered.filter(it => it.Project_Name && it.Project_Name.trim().toLowerCase() === initialProject.trim().toLowerCase());
        }

        // 2. ID Filter
        if (idVal) filtered = filtered.filter(it => it.ID === idVal);

        // 3. Bedroom Filter
        if (bedVal) {
            if (bedVal === "6") filtered = filtered.filter(it => parseInt(it.Bedrooms) >= 6);
            else filtered = filtered.filter(it => parseInt(it.Bedrooms) === parseInt(bedVal));
        }

        // 4. Sort
        filtered.sort((a, b) => {
            return sortVal === "low" ? a.Price - b.Price : b.Price - a.Price;
        });

        render(filtered);
    }

    function render(items) {
        const grid = document.getElementById('grid');
        document.getElementById('loading').style.display = 'none';
        grid.innerHTML = "";

        if (items.length === 0) {
            grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:50px; color:#999;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>`;
            return;
        }

        items.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            const fPrice = Number(item.Price).toLocaleString();
            const detailUrl = 'details.html?id=' + item.HP_ID;
            
            card.innerHTML = `
                <div class="card-img-box" onclick="window.location.href='${detailUrl}'">
                    <div class="hpid-badge">${item.HP_ID} - ${item.ID}</div>
                    <img src="${item.Thumbnail}" class="card-img" onerror="this.src='https://placehold.co/600x400?text=Smart+System'">
                </div>
                <div class="card-body">
                    <div class="status-tag">${item.Status || 'Available'}</div>
                    <div class="card-title">${item.Project_Name}</div>
                    <div class="card-info">
                        <span><i class="fas fa-bed"></i> ${item.Bedrooms || 0} Bed</span>
                        <span><i class="fas fa-bath"></i> ${item.Bathrooms || 0} Bath</span>
                        <span><i class="fas fa-vector-square"></i> ${item['Living Area (sq.m)'] || 0} m¬≤</span>
                    </div>
                    <div class="card-price">‡∏ø${fPrice}</div>
                    <a href="${detailUrl}" class="btn-detail">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
                </div>`;
            grid.appendChild(card);
        });
    }

    loadData();
</script>
</body>
</html>
