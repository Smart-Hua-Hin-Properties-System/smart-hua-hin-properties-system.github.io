<!doctype html>
<html lang="th">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Property Details | SMART SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --bg: #9fb8dc; 
            --card: #ffffff; 
            --primary: #1a5276; 
            --green: #27ae60;
            --radius: 35px; 
        }
        body { 
            margin: 0; 
            font-family: 'Kanit', sans-serif; 
            background: var(--bg); 
            overflow-x: hidden; 
        }
        .page { 
            padding: 20px; 
            display: flex; 
            justify-content: center; 
            min-height: 100vh;
        }
        .container { 
            width: 100%; 
            max-width: 650px; 
        }
        .card { 
            background: var(--card); 
            border-radius: var(--radius); 
            padding: 30px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.15); 
            margin-top: 15px; 
        }
        .btn-back { 
            background: var(--primary); 
            color: #fff; 
            border: none; 
            padding: 10px 25px; 
            border-radius: 50px; 
            cursor: pointer; 
            text-decoration: none; 
            display: inline-flex; 
            align-items: center; 
            gap: 8px;
            font-weight: 500;
        }
        .hero-img { 
            width: 100%; 
            border-radius: 25px; 
            object-fit: cover; 
            margin: 20px 0; 
            max-height: 450px; 
            background: #eee; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .price-tag { 
            font-size: 2.5rem; 
            font-weight: 700; 
            color: var(--green); 
            margin-bottom: 20px; 
        }
        .info-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .pill { 
            display: inline-flex; 
            align-items: center; 
            gap: 8px;
            background: #f1f5f9; 
            padding: 10px 20px; 
            border-radius: 50px; 
            font-size: 0.95rem; 
            font-weight: 500;
            border: 1px solid #e2e8f0;
        }
        .overlay { 
            position: fixed; 
            inset: 0; 
            background: var(--bg); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            z-index: 9999; 
            transition: 0.5s;
        }
        .loader-box { text-align: center; color: white; }
        .bounce-icons { font-size: 50px; margin-bottom: 15px; }
        .bounce-icons span { display: inline-block; animation: bounce 0.6s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-15px); } }
    </style>
</head>
<body>

<div id="overlay" class="overlay">
    <div class="loader-box">
        <div class="bounce-icons"><span>üè†</span><span>‚ú®</span><span>üå¥</span></div>
        <h2 id="msg">FETCHING DETAILS...</h2>
    </div>
</div>

<div class="page">
    <div class="container">
        <a href="index.html" class="btn-back">
            <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </a>

        <div class="card" id="main-content" style="display:none;">
            <h1 id="d_HOUSE_ID" style="color:var(--primary); margin:0; font-size: 2.2rem; font-weight: 900; text-transform: uppercase;">-</h1>
            <div id="d_Proj" style="color:#888; font-weight:500; font-size: 1.1rem; margin-top: 5px;">-</div>
            
            <img id="d_Img" class="hero-img" src="" alt="Property Image">
            
            <div class="price-tag">‡∏ø <span id="d_Price">-</span></div>
            
            <div class="info-grid">
                <div class="pill"><i class="fas fa-bed"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô: <b id="d_Bed">-</b></div>
                <div class="pill"><i class="fas fa-bath"></i> ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥: <b id="d_Bath">-</b></div>
                <div class="pill"><i class="fas fa-map-marker-alt"></i> ‡∏ó‡∏≥‡πÄ‡∏•: <b id="d_Loc">-</b></div>
                <div class="pill"><i class="fas fa-check-circle"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b id="d_Stat">-</b></div>
            </div>

            <div style="margin-top: 30px;">
                <a id="lineBtn" class="btn-back" style="background:#00c300; width:100%; justify-content:center; padding: 15px;" href="#">
                    <i class="fab fa-line fa-lg"></i> ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ú‡πà‡∏≤‡∏ô LINE
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // üö© URL ‡∏Ç‡∏≠‡∏á Web App ‡∏à‡∏≤‡∏Å Apps Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const API_URL = "https://script.google.com/macros/s/AKfycbyS8rGtSnhVS8RdWje7icXZVCw5iBBJoWkEpOYm649OC6FOhnrVi87dD9GsJl_m_FVw/exec";

    async function loadDetail() {
        const params = new URLSearchParams(window.location.search);
        const hp_id = params.get('id'); // ‡∏î‡∏∂‡∏á‡∏£‡∏´‡∏±‡∏™ HP_ID ‡πÄ‡∏ä‡πà‡∏ô HP-0006 ‡∏à‡∏≤‡∏Å URL

        if (!hp_id) {
            document.getElementById('msg').innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå";
            return;
        }

        try {
            const response = await fetch(`${API_URL}?action=getOne&role=PUBLIC&hp_id=${hp_id}`);
            const result = await response.json();

            if (result.success && result.item) {
                const item = result.item;
                
                // ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•: ‡∏ï‡∏±‡∏î Prefix "HOUSE_ID:" ‡∏≠‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
                document.getElementById('d_HOUSE_ID').innerText = item.HOUSE_ID || item.ID;
                
                document.getElementById('d_Proj').innerText = item.Project_Name || "-";
                document.getElementById('d_Price').innerText = Number(item.Price || 0).toLocaleString();
                document.getElementById('d_Img').src = item.Thumbnail || "";
                document.getElementById('d_Bed').innerText = item.Bedrooms || "0";
                document.getElementById('d_Bath').innerText = item.Bathrooms || "0";
                document.getElementById('d_Loc').innerText = (item.District || "") + " / " + (item.SubDistrict || "");
                document.getElementById('d_Stat').innerText = item.Status || "Available";

                // ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏∏‡πà‡∏° LINE (‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
                const shareText = `‡∏™‡∏ô‡πÉ‡∏à‡∏ö‡πâ‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™ ${item.HOUSE_ID} ‡πÉ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ${item.Project_Name}\n‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà: ${window.location.href}`;
                document.getElementById('lineBtn').href = `https://line.me/R/msg/text/?${encodeURIComponent(shareText)}`;

                // ‡∏õ‡∏¥‡∏î Loader ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
                document.getElementById('overlay').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('overlay').style.display = 'none';
                    document.getElementById('main-content').style.display = 'block';
                }, 500);

            } else {
                document.getElementById('msg').innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ô‡∏µ‡πâ";
            }
        } catch (error) {
            console.error(error);
            document.getElementById('msg').innerText = "‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á";
        }
    }

    window.onload = loadDetail;
</script>
</body>
</html>
