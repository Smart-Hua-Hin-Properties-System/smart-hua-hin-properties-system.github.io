<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Details | HUAHIN.PROPERTIES</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Kanit',sans-serif; background:#9CBCE3; margin:0; overflow-x:hidden; width:100%; }
    #loader { height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; text-align:center; }
    .detail-card { background:white; width:92%; max-width:760px; margin:20px auto; border-radius:40px; padding:25px; display:none; box-shadow:0 10px 40px rgba(0,0,0,0.2); }
    .btn-back{ background:#1a5276; color:white; border:none; padding:10px 25px; border-radius:50px; cursor:pointer; margin-bottom:20px; }
    .img{ width:100%; border-radius:22px; margin:15px 0; object-fit:cover; max-height:520px; }
  </style>
</head>
<body>

  <div id="loader">
    <div style="font-size:60px;">üè† ‚ú® üå¥</div>
    <h2 id="msg">FETCHING DETAILS...</h2>
  </div>

  <div id="ui" class="detail-card">
    <button class="btn-back" onclick="location.href='index.html'">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    <div id="content"></div>
  </div>

<script>
  const api = "https://script.google.com/macros/s/AKfycbzkweiEgczmmU_4FiqRffJ4exvgZl3RwGPIBWXssLgkUpdMArif9-eUEv6yP2Kvtzh1/exec";

  function formatToH3(url) {
    if (!url || url.trim() === "") return "https://placehold.co/900x600";
    if (url.includes("https://lh3.googleusercontent.com/d/")) return url;

    let fileId = "";
    try {
      if (url.includes("id=")) fileId = url.split("id=")[1].split("&")[0];
      else if (url.includes("/file/d/")) fileId = url.split("/file/d/")[1].split("/")[0];
    } catch(e) {}
    return fileId ? ("https://lh3.googleusercontent.com/d/" + fileId) : url;
  }

  async function load() {
    const id = new URLSearchParams(window.location.search).get('id');
    if (!id) { document.getElementById('msg').innerText = "‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"; return; }

    try {
      const res = await fetch(`${api}?action=getProperty&id=${encodeURIComponent(id)}`);
      const payload = await res.json();

      if (!payload || !payload.success || !payload.item) {
        document.getElementById('msg').innerText = "PROPERTY NOT FOUND";
        return;
      }

      const item = payload.item;

      document.getElementById('loader').style.display = 'none';
      document.getElementById('ui').style.display = 'block';

      const price = Number(item.Price || 0).toLocaleString();
      const img = formatToH3(item.Thumbnail);

      document.getElementById('content').innerHTML = `
        <h2 style="color:#1a5276; margin:0;">CODE: ${escapeHtml(item.ID || '')}</h2>
        <img class="img" src="${img}" onerror="this.src='https://placehold.co/900x600'">
        <div style="font-size:1.05rem; line-height:1.9;">
          <p>üí∞ <b>‡∏£‡∏≤‡∏Ñ‡∏≤:</b> ‡∏ø${price}</p>
          <p>üè° <b>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</b> ${escapeHtml(item.Project_Name || '')}</p>
          <p>üìç <b>‡∏ó‡∏≥‡πÄ‡∏•:</b> ${escapeHtml(item.District || '')} / ${escapeHtml(item.SubDistrict || '')}</p>
          <p>üõå <b>‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô:</b> ${escapeHtml(item.Bedrooms || '')} &nbsp;&nbsp; üõÅ <b>‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥:</b> ${escapeHtml(item.Bathrooms || '')}</p>
          ${item.Status ? `<p>‚úÖ <b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> ${escapeHtml(item.Status)}</p>` : ``}
        </div>
      `;
    } catch (e) {
      document.getElementById('msg').innerText = "ERROR LOADING DATA";
    }
  }

  function escapeHtml(str){
    return String(str || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  window.onload = load;
</script>
</body>
</html>
